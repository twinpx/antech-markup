!function(a){"use strict";a(function(){function b(){var b=Number(a(".input_product_quantity").val());b>o?b=o:b<n&&(b=n),a(".input_product_quantity").val(b)}function c(){var c=Number(a(".input_product_quantity").val());a(".input_product_quantity").val(c+m),b(),f()}function d(){var c=Number(a(".input_product_quantity").data("stepquantity")),d=Number(a(".input_product_quantity").val());a(".input_product_quantity").val(d-c),b(),f()}function e(a){return a+="",a=new Array(4-a.length%3).join("U")+a,a.replace(/([0-9U]{3})/g,"$1 ").replace(/U/g,"")}function f(){var b=Number(a(".input_product_quantity").val());b>=l[2]?k=j.removeClass("i-active").eq(2).addClass("i-active").find("i").text():b>=l[1]?k=j.removeClass("i-active").eq(1).addClass("i-active").find("i").text():b>=l[0]&&(k=j.removeClass("i-active").eq(0).addClass("i-active").find("i").text()),a(".b-catalog-detail__sum i").text(e((b*Number(k)).toFixed(2)).replace(" .","."));var c=a(".b-catalog-detail .btn-cart").attr("href"),d=!1,f=!1;c=c.split("?"),c[1]&&(f=!0);for(var g=0;g<c.length;g++){c[g]=c[g].split("&");for(var h=0;h<c[g].length;h++)c[g][h]=c[g][h].split("="),"QUANTITY"===c[g][h][0]&&(d=!0,c[g][h][1]=b),c[g][h]=c[g][h].join("=");c[g]=c[g].join("&")}c=c.join("?"),d||(c+=f?"&":"?",c+="QUANTITY="+b),a(".b-catalog-detail .btn-cart").attr("href",c)}function g(a){return/(10|11|12|13|14|15|16|17|18|19)$/.test(a)?"товаров":/.*1$/.test(a)?"товар":/[2-4]$/.test(a)?"товара":"товаров"}var h=[],i=[];a(".b-catalog-detail__price-block .col-xs-4").each(function(){var b=a(this),c=Number(a(this).find(".text-center:eq(0) i").text());h.push(b),i.push(c)}),a(".b-catalog-detail__price-block").empty().append(h[0]),i[1]>i[0]?h[0].after(h[1]):h[0].before(h[1]),i[2]>i[0]&&i[2]>i[1]?a(".b-catalog-detail__price-block").append(h[2]):i[2]<i[0]&&i[2]<i[1]?a(".b-catalog-detail__price-block").prepend(h[2]):i[2]>i[0]&&i[2]<i[1]?h[1].before(h[2]):h[0].before(h[2]);var j=a(".b-catalog-detail__price"),k=0,l=[],m=Number(a(".input_product_quantity").data("stepquantity")),n=0,o=Math.floor(Number(a(".b-catalog-detail__available b").text().split(" ").join(""))/m)*m;a(".b-catalog-detail__price-block .col-xs-4").each(function(){l.push(Number(a(this).find(".text-center:eq(0) i").text()))}),l[0]<m&&(l[0]=m),n=l[0],a(".up_quantity_btn").bind("click",c),a(".down_quantity_btn").bind("click",d),a(".input_product_quantity").bind("keyup",f).bind("blur",b),a(".b-catalog-detail__price-block").delegate(".b-catalog-detail__price","click",function(){a(".b-catalog-detail__price").removeClass("i-active"),a(this).addClass("i-active"),a(".input_product_quantity").val(l[a(".b-catalog-detail__price").index(a(this))]),f()}),a(".b-catalog-detail").delegate(".btn-cart","click",function(b){b.preventDefault();var c=a(this);c.hasClass(".btn-disabled")||(c.addClass("btn-disabled").text("В корзине"),a.ajax({url:c.attr("href"),type:"GET",dataType:"json",success:function(b){b&&"Y"===b.STATUS?b.DATA.COUNT>0?(a("#cartModalButton").css({visibility:"visible"}),a("#cartModalCount").text(b.DATA.COUNT),a("#cartModalPrice").text(b.DATA.TOTAL_PRICE),a("#cartModalNoProducts").hide(),a("#cartModalHasProducts").text(g(b.DATA.COUNT)+" на сумму"),a(".count_in_cart").show().text(b.DATA.COUNT)):a(".count_in_cart").hide().text(b.DATA.COUNT):"E"===b.STATUS&&c.removeClass("btn-disabled").text("В корзину")},error:function(a,b,c){window.console&&(console.log(a),console.log(b),console.log(c))}}))})})}(jQuery);