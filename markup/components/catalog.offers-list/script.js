$(function(){function a(a){var b=a.parents("form"),c=$("input.add-to-cart-input-quantity",b),e=Number(c.data("oncart")),f=Number(c.val()),g=Number(c.data("freequantity")),h=$(".add-pring-chb",b),i=h.prop("checked"),j=h.data("defaultval"),k=!1,l="Добавить к заказу",m=l,n=Number(c.data("quantityrangeone")),o=Number(c.data("quantityrangetwo")),p=Number(c.data("quantityrangetre"));d(b),"undefined"==g&&(g=0),"undefined"!=e&&"NaN"!=e||(e=0),b.hasClass("offers_item_preorder")&&(!0,l="Сделать предзаказ",m=l),0==b.hasClass("offers_item_preorder")&&(g<f?(k=!0,m="Сделать предзаказ",$(".preorder_popower",b).hasClass("popoverOpen")||$(".preorder_popower",b).popover("show").addClass("popoverOpen")):(k=!1,$(".preorder_popower",b).popover("hide").removeClass("popoverOpen"))),e>0&&(e==f?(k=!1,m="Добавлено к заказу"):(k=!0,m="Обновить количество")),1==i?("N"==j&&(k=!0,m="Обновить параметры"),b.addClass("mode-order").removeClass("mode-standart"),0==b.hasClass("offers_item_preorder")&&b.removeClass("mode-cart").addClass("mode-order")):("Y"==j&&(k=!0,m="Обновить параметры"),b.removeClass("mode-order").addClass("mode-standart"),0==b.hasClass("offers_item_preorder")&&b.removeClass("mode-order").addClass("mode-cart"),$(".price-range",b).removeClass("in"),f>=n&&f<o&&$(".price-range-1",b).addClass("in"),f>=o&&f<p&&$(".price-range-2",b).addClass("in"),f>=p&&$(".price-range-3",b).addClass("in")),a.attr("title",m),k?(b.removeClass("form-disabled"),e>0&&b.addClass("in-cart-update")):(b.removeClass("in-cart-update"),e>0&&(e==f?b.addClass("form-disabled"):b.removeClass("form-disabled")))}function b(b){var c=b.parents("form"),d=$(".add-to-order-btn",c),e=Number(b.data("minorder"));a(d),(0==checkToMultiple(b.val(),b.data("inputstep"))||e>Number(b.val()))&&Number(b.val())>0?($(".add-to-cart-input-quantity").not(b).popover("hide").removeClass("popoverOpen"),b.hasClass("popoverOpen")||b.popover("show").addClass("popoverOpen")):b.popover("hide").removeClass("popoverOpen"),b.val()<=0&&b.val("")}function c(a){a.val()>0&&a.val()<Number(a.data("inputmin"))&&a.val(Number(a.data("inputmin")))}function d(a){var b="";return a.hasClass("mode-default")&&(b="default"),a.hasClass("mode-preorder")&&(b="preorder"),a.hasClass("mode-orderprint")&&(b="orderprint"),a.hasClass("mode-update")&&(b="update"),a.hasClass("mode-updatepreorder")&&(b="updatepreorder"),a.hasClass("mode-updateprint")&&(b="updateprint"),a.hasClass("mode-incart")&&(b="incart"),a.hasClass("mode-incartpreorder")&&(b="incartpreorder"),a.hasClass("mode-incartprint")&&(b="incartprint"),b}$(".offers-block .popover_teaser").popover(),$(".offers-block .popover_preview_image").popover({html:!0,trigger:"hover",container:"body",toggle:"popover",placement:"top"}),$(".add-pring-chb").change(function(){a($(".add-to-order-btn",$(this).parents("form")))}),$("form.offers_item_add2cart").submit(function(){var a=$(this),b=$(".add-pring-chb",a),c=b.prop("checked");return $.ajax({url:a.attr("action"),method:"POST",data:a.serialize(),success:function(d){"Y"==d.STATUS?(a.addClass("form-disabled").removeClass("in-cart-update").removeClass("preorder").attr("title","Добавлено к заказу"),$(".add-to-cart-input-quantity",a).data("oncart",$(".add-to-cart-input-quantity",a).val()),$('input[name="MODE"]',a).val("UPDATE"),1==c?b.data("defaultval","Y"):b.data("defaultval","N"),d.DATA.COUNT>0?$(".count_in_cart").show().text(d.DATA.COUNT):$(".count_in_cart").hide().text(d.DATA.COUNT)):"E"==d.STATUS&&alert(d.MESSAGE)},error:function(a){}}),!1}),$("input.add-to-cart-input-quantity").change(function(){c($(this)),b($(this))}).keyup(function(){b($(this))}),$(".input-wrapper").click(function(a){a.stopPropagation()}),$(".show-all-offers").click(function(){return parent=$(this).parent(),$(".cat-hidden").removeClass("cat-hidden").addClass("cat-visible"),$(this).hide(),!1}),$(".add-to-favorite-btn").click(function(){var a=$(this),b=(a.parents("form"),a.data("offersid")),c="ADD",d=a.data("actionurl");a.hasClass("active")&&(c="DEL"),$.ajax({url:d,method:"POST",data:{OFFERS_ID:b,MODE:c},success:function(b){"Y"==b.STATUS?"ADD"==c?a.addClass("active"):a.removeClass("active"):console.log(b)},error:function(a){console.log(a)}})}),$(".price-range").click(function(){var a=$(this).parents("form"),b=$(this).data("addquant");return $(".add-to-cart-input-quantity",a).val(b).change(),!1}),$("body").click(function(){$(".preorder_popower, .add-to-cart-input-quantity").popover("hide").removeClass("popoverOpen")})});