function refrashModalCart(a){a.DATA.COUNT>0?($("#inCartIndicator").show().text(a.DATA.COUNT),$("#cartModalButton").css({visibility:"visible"}),$("#cartModalCount").text(a.DATA.COUNT),$("#cartModalPrice").text(a.DATA.TOTAL_PRICE),$("#cartModalNoProducts").hide()):$("#inCartIndicator").hide().text(a.DATA.COUNT)}$(function(){function a(a){var b=a.parents("form"),c=$("input.add-to-cart-input-quantity",b),d=Number(c.data("oncart")),e=Number(c.val()),f=Number(c.data("freequantity")),g=$(".add-pring-chb",b),h=g.prop("checked"),i=g.data("defaultval"),j=!1,k="Добавить<br>к&nbsp;заказу",l=Number(c.data("quantityrangeone")),m=Number(c.data("quantityrangetwo")),n=Number(c.data("quantityrangetre")),o=$(".cur-quantity-indikator",b),p=0;"undefined"==f&&(f=0),"undefined"!=d&&"NaN"!=d||(d=0),0==b.hasClass("offers_item_preorder")&&(f<e?(j=!0,k="Сделать<br>предзаказ",$(".preorder_popower",b).hasClass("popoverOpen")||$(".preorder_popower",b).popover("show").addClass("popoverOpen")):(j=!1,$(".preorder_popower",b).popover("hide").removeClass("popoverOpen"))),d>0&&(d==e?(j=!1,k="Добавлено<br>к заказу"):(j=!0,k="Обновить<br>количество")),1==h?("N"==i&&(j=!0,k="Обновить<br>параметры"),$(".order-price-print",b).show().removeClass("hidden"),$(".order-price-default",b).hide(),0==b.hasClass("offers_item_preorder")&&a.removeClass("mode-cart").addClass("mode-order"),o.hide()):("Y"==i&&(j=!0,k="Обновить<br>параметры"),$(".order-price-print",b).hide(),$(".order-price-default",b).show().removeClass("hidden"),0==b.hasClass("offers_item_preorder")&&a.removeClass("mode-order").addClass("mode-cart"),$(window).width()>768?(e>=l&&(p=1),e>=m&&(p=2),e>=n&&(p=3),p>0?o.show().removeClass("col-sm-offset-3").removeClass("col-sm-offset-4").removeClass("col-sm-offset-5").addClass("col-sm-offset-"+(3+p)):o.hide()):o.hide()),a.html(k),j?(a.removeClass("btn-disabled"),d>0&&a.addClass("in-cart-update")):(a.removeClass("in-cart-update"),d>0&&(d==e?a.addClass("btn-disabled"):a.removeClass("btn-disabled")))}function b(b){var c=b.parents("form");a($(".add-to-order-btn",c)),checkToMultiple(b.val(),b.data("inputstep"))?b.popover("hide"):b.popover("show"),0==b.val()&&b.val("")}$(".add-to-cart-input-quantity, .popover_teaser").popover(),$(".add-pring-chb").change(function(){a($(".add-to-order-btn",$(this).parents("form")))}),$("form.offers_item_add2cart").submit(function(){var a=$(this),b=$(".add-pring-chb",a),c=b.prop("checked"),d=$(".add-to-cart-input-quantity",a);return Number(d.val())<Number(d.data("inputstep"))&&d.val(d.data("inputstep")),$.ajax({url:a.attr("action"),method:"POST",data:a.serialize(),success:function(d){"Y"==d.STATUS?($(".add-to-order-btn",a).addClass("btn-disabled").removeClass("in-cart-update").removeClass("preorder").html("Добавлено<br>к заказу"),$(".add-to-cart-input-quantity",a).data("oncart",$(".add-to-cart-input-quantity",a).val()),$('input[name="MODE"]',a).val("UPDATE"),1==c?b.data("defaultval","Y"):b.data("defaultval","N"),refrashModalCart(d)):"E"==d.STATUS&&alert(d.MESSAGE)},error:function(a){}}),!1}),$("input.add-to-cart-input-quantity").change(function(){b($(this));var a=$(this);a.val()>0&&a.val()<Number(a.data("inputmin"))&&a.val(Number(a.data("inputmin")))}).keyup(function(){b($(this))}),$(".input-wrapper").click(function(a){a.stopPropagation()}),$("body").click(function(){$(".preorder_popower").popover("hide").removeClass("popoverOpen")})});