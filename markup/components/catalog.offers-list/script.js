$(function(){function a(a){var b=a.parents("form"),c=$("input.add-to-cart-input-quantity",b),d=Number(c.data("oncart")),e=Number(c.val()),f=Number(c.data("freequantity")),g=$(".add-pring-chb",b),h=g.prop("checked"),i=g.data("defaultval"),j=!1,k="Добавить<br>к&nbsp;заказу",l=Number(c.data("quantityrangeone")),m=Number(c.data("quantityrangetwo")),n=Number(c.data("quantityrangetre")),o=$(".cur-quantity-indikator",b),p=0;"undefined"==f&&(f=0),"undefined"!=d&&"NaN"!=d||(d=0),f<e?(j=!0,k="Сделать<br>предзаказ",$(".preorder_popower",b).hasClass("popoverOpen")||$(".preorder_popower",b).popover("show").addClass("popoverOpen")):(j=!1,$(".preorder_popower",b).popover("hide").removeClass("popoverOpen")),d>0&&(d==e?(j=!1,k="Поставлено<br>в&nbsp;резерв"):(j=!0,k="Обновить<br>количество")),1==h?("N"==i&&(j=!0,k="Обновить<br>параметры"),$(".order-price-print",b).show().removeClass("hidden"),$(".order-price-default",b).hide(),a.removeClass("mode-cart").addClass("mode-order"),o.hide()):("Y"==i&&(j=!0,k="Обновить<br>параметры"),$(".order-price-print",b).hide(),$(".order-price-default",b).show().removeClass("hidden"),a.removeClass("mode-order").addClass("mode-cart"),$(window).width()>768?(e>=l&&(p=1),e>=m&&(p=2),e>=n&&(p=3),p>0?o.show().removeClass("col-sm-offset-3").removeClass("col-sm-offset-4").removeClass("col-sm-offset-5").addClass("col-sm-offset-"+(3+p)):o.hide()):o.hide()),j?a.removeClass("btn-disabled").html(k):a.addClass("btn-disabled").html(k)}function b(b){var c=b.parents("form");a($(".add-to-order-btn",c)),checkToMultiple(b.val(),b.data("inputstep"))?b.popover("hide"):b.popover("show"),0==b.val()&&b.val("")}$(".add-to-cart-input-quantity, .popover_teaser").popover(),$(".add-pring-chb").change(function(){a($(".add-to-order-btn",$(this).parents("form")))}),$("form.offers_item_add2cart").submit(function(){var a=$(this),b=$(".add-pring-chb",a),c=b.prop("checked");return $.ajax({url:a.attr("actions"),method:"POST",data:a.serialize(),success:function(d){"Y"==d.STATUS?($(".add-to-order-btn",a).addClass("btn-disabled").removeClass("preorder").html("Поставлено<br>в&nbsp;резерв"),$(".add-to-cart-input-quantity",a).data("oncart",$(".add-to-cart-input-quantity",a).val()),$('input[name="MODE"]',a).val("UPDATE"),1==c?b.data("defaultval","Y"):b.data("defaultval","N"),d.DATA.COUNT>0?$(".count_in_cart").show().text(d.DATA.COUNT):$(".count_in_cart").hide().text(d.DATA.COUNT)):"E"==d.STATUS&&alert(d.MESSAGE)},error:function(a){}}),!1}),$("input.add-to-cart-input-quantity").change(function(){b($(this))}).keyup(function(){b($(this))}),$(".input-wrapper").click(function(a){a.stopPropagation()}),$("body").click(function(){$(".preorder_popower").popover("hide").removeClass("popoverOpen")})});