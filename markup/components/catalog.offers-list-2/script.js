$(function(){function a(a){var b=a.parents("form"),c=$("input.add-to-cart-input-quantity",b),d=Number(c.data("oncart")),e=Number(c.val()),f=Number(c.data("freequantity")),g=$(".add-pring-chb",b),h=g.prop("checked"),i=g.data("defaultval"),j=!1,k="Добавить<br>к&nbsp;заказу",l=k,m=Number(c.data("quantityrangeone")),n=Number(c.data("quantityrangetwo")),o=Number(c.data("quantityrangetre"));"undefined"==f&&(f=0),"undefined"!=d&&"NaN"!=d||(d=0),b.hasClass("offers_item_preorder")&&(!0,k="Сделать<br>предзаказ",l=k),0==b.hasClass("offers_item_preorder")&&(f<e?(j=!0,l="Сделать<br>предзаказ",$(".preorder_popower",b).hasClass("popoverOpen")||$(".preorder_popower",b).popover("show").addClass("popoverOpen")):(j=!1,$(".preorder_popower",b).popover("hide").removeClass("popoverOpen"))),d>0&&(d==e?(j=!1,l="Добавлено<br>к заказу"):(j=!0,l="Обновить<br>количество")),1==h?("N"==i&&(j=!0,l="Обновить<br>параметры"),b.addClass("mode-order").removeClass("mode-standart"),0==b.hasClass("offers_item_preorder")&&a.removeClass("mode-cart").addClass("mode-order")):("Y"==i&&(j=!0,l="Обновить<br>параметры"),b.removeClass("mode-order").addClass("mode-standart"),0==b.hasClass("offers_item_preorder")&&a.removeClass("mode-order").addClass("mode-cart"),$(".item-cell-price-td",b).removeClass("in"),e>=m&&e<n&&$(".price-range-1",b).addClass("in"),e>=n&&e<o&&$(".price-range-2",b).addClass("in"),e>=o&&$(".price-range-3",b).addClass("in")),a.html(l),j?(a.removeClass("btn-disabled"),d>0&&a.addClass("in-cart-update")):(a.removeClass("in-cart-update"),d>0&&(d==e?a.addClass("btn-disabled"):a.removeClass("btn-disabled")))}function b(b){var c=b.parents("form"),d=$(".add-to-order-btn",c),e=Number(b.data("minorder"));a(d),(0==checkToMultiple(b.val(),b.data("inputstep"))||e>Number(b.val()))&&Number(b.val())>0?($(".add-to-cart-input-quantity").not(b).popover("hide").removeClass("popoverOpen"),b.hasClass("popoverOpen")||b.popover("show").addClass("popoverOpen")):b.popover("hide").removeClass("popoverOpen"),b.val()<=0&&b.val("")}function c(a){a.val()>0&&a.val()<Number(a.data("inputmin"))&&a.val(Number(a.data("inputmin")))}$(".offers-block .popover_teaser").popover(),$(".offers-block .popover_preview_image").popover({html:!0,trigger:"hover",container:"body",toggle:"popover",placement:"top"}),$(".add-pring-chb").change(function(){a($(".add-to-order-btn",$(this).parents("form")))}),$("form.offers_item_add2cart").submit(function(){var a=$(this),b=$(".add-pring-chb",a),c=b.prop("checked");return $.ajax({url:a.attr("action"),method:"POST",data:a.serialize(),success:function(d){"Y"==d.STATUS?($(".add-to-order-btn",a).addClass("btn-disabled").removeClass("in-cart-update").removeClass("preorder").html("Добавлено<br>к заказу"),$(".add-to-cart-input-quantity",a).data("oncart",$(".add-to-cart-input-quantity",a).val()),$('input[name="MODE"]',a).val("UPDATE"),1==c?b.data("defaultval","Y"):b.data("defaultval","N"),d.DATA.COUNT>0?$(".count_in_cart").show().text(d.DATA.COUNT):$(".count_in_cart").hide().text(d.DATA.COUNT)):"E"==d.STATUS&&alert(d.MESSAGE)},error:function(a){}}),!1}),$("input.add-to-cart-input-quantity").change(function(){c($(this)),b($(this))}).keyup(function(){b($(this))}),$(".input-wrapper").click(function(a){a.stopPropagation()}),$("body").click(function(){$(".preorder_popower, .add-to-cart-input-quantity").popover("hide").removeClass("popoverOpen")})});